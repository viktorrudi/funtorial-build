<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Discounts</title>
    <!-- Main style -->
    <link rel="stylesheet" href="scss/style.css" />
    <!-- Bootstrap style -->
    <link rel="stylesheet" href="node_modules/bootstrap/dist/css/bootstrap.min.css" />
    <!-- INCLUDE POPPER AND JQUERY HERE -->
  </head>

  <body>
    <div class="container page__intro">
      <h1>What do you want to learn?</h1>
    </div>
    <div class="container categories selection__new-topics">
      <div class="row category category__type--languages">
        <div class="col-md-3">
          <h4 class="category__name">Languages</h4>
          <!-- Counter -->
          <p class="category__description">
            Pick between one of our
            <strong class="topic__counter"> <!-- Automatically acounted and filled --> </strong>
            languages
          </p>
        </div>
        <div
          id="category__feed--lang"
          class="col-md-9 category__items--wrapper fading wrapper__collapsed"
          style="height: unset;"
        >
          <!-- Category item (start) - Languages -->
          <div class="category__item">
            <!-- Anchor and tooltip. Tooltip text in "title".  -->
            <a
              data-topic-id="1"
              href="#"
              data-toggle="tooltip"
              data-placement="top"
              title="American English"
            >
              <span class="category__item--icon">
                <!-- Flag file in data. Data attribute or object element is optional -->
                <object data="img/flags/gb.svg" type="image/svg+xml"></object>
              </span>
              <!-- Language -->
              <p>Language name</p>
            </a>
          </div>
          <!-- Category item (end) - Languages -->
        </div>
      </div>

      <div class="row category category__type--school">
        <div class="col-md-3">
          <h4 class="category__name">School topics</h4>
          <!-- Counter -->
          <p class="category__description">
            Pick between one of our
            <strong class="topic__counter"> <!-- Automatically acounted and filled --> </strong>
            topics
          </p>
        </div>
        <div id="category__feed--school" class="col-md-9 category__items--wrapper">
          <!-- Category item (start) - School topics -->
          <div class="category__item">
            <!-- Anchor and tooltip. Tooltip text in "title".  -->
            <a
              data-topic-id="2"
              href="#"
              data-toggle="tooltip"
              data-placement="top"
              title="Topic full namee"
            >
              <span class="category__item--icon">
                <!-- Icon file into "data". Data attribute or object element is optional -->
                <object data="" type="image/svg+xml"></object>
              </span>
              <!-- School topic -->
              <p>Topic name</p>
            </a>
          </div>
          <!-- Category item (start) - School topics -->
        </div>
      </div>

      <div class="row category category__type--quiz">
        <div class="col-md-3">
          <h4 class="category__name">Quizzes</h4>
          <!-- Counter -->
          <p class="category__description">
            Pick between one of our
            <strong class="topic__counter"> <!-- Automatically acounted and filled --> </strong>
            quizzes
          </p>
        </div>
        <div id="category__feed--quiz" class="col-md-9 category__items--wrapper">
          <!-- Category item (start) - Quizzes -->
          <div class="category__item">
            <!-- Anchor and tooltip. Tooltip text in "title".  -->
            <a
              data-topic-id="3"
              href="#"
              data-toggle="tooltip"
              data-placement="top"
              title="Quiz full name"
            >
              <span class="category__item--icon">
                <!-- Flag file in data. Data attribute or object element is optional -->
                <object data="" type="image/svg+xml"></object>
              </span>
              <!-- Quiz -->
              <p>Quiz name</p>
            </a>
          </div>
          <!-- Category item (end) - Quizzes -->
        </div>
      </div>
    </div>

    <!-- JS -->
    <script>
      // UTILITIES
      $(function() {
        $('[data-toggle="tooltip"]').tooltip()
        $('[data-toggle="popover"]').popover()
      })

      // TOPICS PAGE
      function topicFunctions() {
        const addExtendButton = () => {
          //Create buttons and fade effect
          const topicExtendBtnFade = document.createElement('div')
          const topicExtendBtn = document.createElement('div')
          const topicExtendBtnArrow = document.createElement('i')
          topicExtendBtnFade.setAttribute('class', 'category__items--fade-overlay')
          topicExtendBtn.setAttribute('class', 'category__items--extend-btn')
          topicExtendBtnArrow.setAttribute('class', 'fas fa-angle-down')
          topicExtendBtn.appendChild(topicExtendBtnArrow)

          const topicWrappers = Array.from(document.querySelectorAll('.category__items--wrapper'))

          topicWrappers.map(topicWrapper => {
            //Temporarely setting height to find out if div is overflowing. Max 3 rows for desktop version.
            topicWrapper.style.height = '161px'

            // If wrapper is overflowing - show buttons
            if (topicWrapper.scrollHeight > topicWrapper.clientHeight) {
              console.log('scrollheight (div content size): ' + topicWrapper.scrollHeight)
              console.log('clientheight (view size?): ' + topicWrapper.clientHeight)

              topicWrapper.appendChild(topicExtendBtnFade.cloneNode(true))
              topicWrapper.appendChild(topicExtendBtn.cloneNode(true))
            }

            // Removing temp height set. Going back to only using max-height for animation puropses
            topicWrapper.style.height = 'unset'
          })
        }

        const closeAll = () => {
          const wrappers = Array.from(document.querySelectorAll('.category__items--wrapper'))
          wrappers.map(wrapper => {
            wrapper.classList.add('wrapper__collapsed')
          })
        }

        const toggleOnClick = () => {
          const buttons = Array.from(document.querySelectorAll('.category__items--extend-btn'))
          buttons.map(button => {
            button.addEventListener('click', e => {
              closeCat(e)
              const parent = e.target.parentElement
              parent.querySelector('.category__items--fade-overlay').classList.toggle('hidden')
            })
          })

          const closeCat = e => {
            //Append wrapper_closed class on click
            e.path[1].classList.toggle('wrapper__collapsed')
            let btnArrow = e.path[0].childNodes[0]

            //Rotate arrow if opened
            if (btnArrow.classList[1] == 'fa-angle-down') {
              btnArrow.classList = 'fa fa-angle-up'
            } else {
              btnArrow.classList = 'fa fa-angle-down'
            }
          }
        }

        // Adds number to counter next to category, and hides the entire category if empty
        const countTopics = () => {
          if (document.querySelector('.topic__counter')) {
            const topic = {
              languages() {
                const allTopics = Array.from(
                  document.querySelectorAll('#category__feed--lang .category__item')
                )
                const displayCounter = document.querySelector(
                  '.category__type--languages .topic__counter'
                )
                displayCounter.innerHTML = allTopics.length

                if (allTopics.length === 0) {
                  document.querySelector('.category__type--languages').style.display = 'none'
                }
              },

              schoolTopics() {
                const allTopics = Array.from(
                  document.querySelectorAll('#category__feed--school .category__item')
                )
                const displayCounter = document.querySelector(
                  '.category__type--school .topic__counter'
                )
                displayCounter.innerHTML = allTopics.length

                if (allTopics.length === 0) {
                  document.querySelector('.category__type--school').style.display = 'none'
                }
              },

              quizzes() {
                const allTopics = Array.from(
                  document.querySelectorAll('#category__feed--quiz .category__item')
                )
                const displayCounter = document.querySelector(
                  '.category__type--quiz .topic__counter'
                )
                displayCounter.innerHTML = allTopics.length

                if (allTopics.length === 0) {
                  document.querySelector('.category__type--quiz').style.display = 'none'
                }
              },
            }
            topic.languages()
            topic.schoolTopics()
            topic.quizzes()
          }
        }

        // For topic selection (after chosen excersise in category)
        const noTopicsSelected = () => {
          const languagesWrapper = document.querySelector('#category__feed--lang'),
            schoolTopicWrapper = document.querySelector('#category__feed--school'),
            quizzesWrapper = document.querySelector('#category__feed--quiz')
          const wrappers = [languagesWrapper, schoolTopicWrapper, quizzesWrapper]

          wrappers.map(wrapper => {
            // Only showing message to find another category exercise if its empty
            if (document.querySelector('.category__feed--none-selected')) {
              if (wrapper.childElementCount <= 1) {
                wrapper.querySelector('.category__feed--none-selected').style.display = 'block'
              }
            }
          })
        }

        addExtendButton() // Creates a button to extend to see more topics if there are more than what the div can contain
        closeAll() // Initially closes all categories
        countTopics() //Counts numbers of topics in category and displays it
        toggleOnClick() // Functionality for opening and closing selection
        noTopicsSelected() // For topic selection (after chosen excersise in category)
      }

      topicFunctions()
    </script>
  </body>
</html>
