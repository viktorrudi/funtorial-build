<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Front page</title>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.8.2/css/all.min.css">
  <!-- Main style -->
  <link rel="stylesheet" href="dist/main.css">

</head>

<body>
  <nav class="navbar navbar-expand-lg fixed-top">
    <div class="container">
      <a class="navbar-brand" href="#">
        <img class="navbar-logo" src="img/ft-logo.png" alt="" />
      </a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarContent"
        aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"><i class="fas fa-bars"></i></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarContent">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item active">
            <a class="nav-link" href="#">Link 1</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">Link 2</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">Link 3</a>
          </li>
        </ul>

        <ul class="nav-right navbar-nav">
          <li class="nav-credits nav-item">
            <div class="nav-link">
              <span class="credit-container">
                <object class="navbar-credit-icon" data="img/div_icons/piggie-nav.svg" type="image/svg+xml"></object>
                55
              </span>
            </div>
          </li>

          <li class="nav-profile nav-item dropdown">
            <a href="#" class="nav-link" data-toggle="dropdown" data-target="dropdown__profile">
              <span class="profile-container">
                <span class="profile-picture"></span>
              </span>
            </a>
            <!-- Hidden dropdown meny for when you click on users profile picture -->
            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdown__profile">
              <div class="dropdown__profile-container">
                <!-- Name of the logged in user -->
                <span class="dropdown-item-text">Hi !Name</span>
                <div class="dropdown__profile--main">
                  <a href="#" class="dropdown-item">
                    Account settings <i class="fas fa-cog"></i>
                  </a>
                  <a href="#" class="dropdown-item">
                    My statistics <i class="fas fa-chart-pie"></i>
                  </a>
                  <!-- Not created page for yet. Pavel need to make a decision about a potential "my discounts" -->
                  <a href="#" class="dropdown-item">My discounts <i class="fas fa-tag"></i></a>
                </div>
                <!-- Logout link -->
                <a href="#" class="dropdown-item dropdown__profile--logout">
                  Log out <i class="fas fa-sign-out-alt"></i>
                </a>
              </div>
            </div>
          </li>

          <!-- Separator -->
          <span class="vertical-line"></span>

          <div class="dropdown show dropdown-lang">
            <!-- LANGUAGE SELECTION BAR -->
            <!-- This anchor is for the selected language. Leave # for the anchor -->
            <a class="btn dropdown-toggle" href="#" id="1" data-country-code="en" data-toggle="dropdown"
              data-target="dropdown__languages"><span class="flag-wrapper">
                <!-- Insert flag link into data -->
                <object class="navbar-flag-selected" data="./img/flags/gb.svg" type="image/svg+xml"></object>
              </span>
              English
            </a>

            <!-- Hidden box containing the rest of the available languages. Requires bootstrap js -->
            <div id="dropdown__languages" class="dropdown-menu dropdown-menu-right">
              <!-- Starting available languages (each anchor). Anchor should lead to language version -->
              <a class="dropdown-item" href="#" id="1" data-country-code="no">
                <span class="flag-wrapper">
                  <!-- Insert flag link into data -->
                  <object class="navbar-flag-selected" data="./img/flags/no.svg" type="image/svg+xml"></object>
                </span>
                Norwegian
              </a>
              <!-- Ending available languages (anchor) -->
            </div>
            <!-- Hidden box ending (for available languages) -->
            <!-- LANGUAGE SELECTION BAR ENDING -->
          </div>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container page__intro">
    <h1>Discounts</h1>
  </div>

  <div class="container">
    <!-- Search container. I havent set up any functionality for this. -->
    <div class="row search__wrapper">
      <form action="" class="detailed-form form-discounts">
        <div class="col-md-2 search__wrapper--instance">
          <label for="search_discountpercent">Discount %</label>
          <select class="form-control" name="search_discount" id="search_discountpercent">
            <!-- Insert available discount in a list -->
            <option value="x">x</option>
          </select>
        </div>
        <div class="col-md-4 search__wrapper--instance">
          <label for="search_country">Country</label>
          <select class="form-control" name="search_country" id="search_discountpercent">
            <!-- Insert available countries -->
            <option value="x">x</option>
          </select>
        </div>
        <div class="col-md-4 search__wrapper--instance">
          <label for="search_city">City</label>
          <!-- Input field for the city -->
          <input class="form-control" type="text" id="search_city" />
        </div>
        <div class="col-md-2 search__wrapper--instance">
          <label class="hidden" for="search_btn">Search</label>
          <button type="submit" id="search_btn" class="form-control">
            <i class="fas fa-paper-plane"></i> Search
          </button>
        </div>
      </form>
      <!-- Search container ending -->
    </div>

    <hr />
    <div id="discount__feed">
      <!-- DISCOUNT ROW STARTING. This is where the loop should start for each discount instance -->

      <div class="row discount__wrapper">
        <div class="col-sm-3 discount__wrapper--image">
          <!-- If no image for discount, use discount-placeholder.png -->
          <img src="/img/discount-placeholder.png" alt="Discount" />
        </div>
        <div class="col-sm-9 discount__header">
          <div class="discount__header--prices">
            <!-- Discount percentage -->
            <span class="percent-percent">15%</span>
            <!-- Price after discount -->
            <span class="price-new">10 CZK</span>
            <!-- Price before discount -->
            <span class="price-old">20 CZK</span>
          </div>
          <div class="discount__header--content">
            <!-- Discount title -->
            <h4>Discount title</h4>
            <!-- Discount description -->
            <p>
              Discount description. Lorem ipsum dolor sit amet consectetur adipisicing elit. Fuga
              voluptates corporis et, numquam molestias incidunt vero ut iste perspiciatis, amet
              saepe quas non temporibus facilis consectetur veniam cumque voluptatibus voluptatem.
            </p>
            <!-- Hidden table which is toggled visible on "See more details" click -->
            <table>
              <tbody>
                <tr>
                  <td>City</td>
                  <td>Brno</td>
                </tr>

                <tr>
                  <td>Country</td>
                  <td>CZ</td>
                </tr>

                <tr>
                  <td>Valid from</td>
                  <td>01.01.2018</td>
                </tr>

                <tr>
                  <td>Valid to</td>
                  <td>01.01.2020</td>
                </tr>

                <tr>
                  <td>Provider</td>
                  <td>Heureka</td>
                </tr>

                <tr>
                  <td>E-mail</td>
                  <td>info@provider.com</td>
                </tr>

                <tr>
                  <td>Phone number</td>
                  <td>123 123 123</td>
                </tr>

                <tr>
                  <td>Address</td>
                  <td>Divalid 3, 232 Wrappi</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="discount__buttons">
            <!-- Button to extend the view of the table above, along with showing the whole description -->
            <button class="discount__btn--see-more btn-secondary">
              <i class="fas fa-angle-down"></i> See more details
            </button>
            <!-- Button to open modal, inserting data from discount into data-discount-info, which is used for the modal.
                  Message inserted into extra.message goes in a hidden textfield, which should be for the email to the provider.
                  Same goes for the email address.
                  The text inside thee button should contain the credit cost (1050 in this dummy)  -->
            <button data-discount-id="1" data-discount-info='{
                  "id":1,
                  "name":"Discount name",
                  "description":"Discount description",
                  "priceNew":"10",
                  "priceOld":"20",
                  "percent":"15",
                  "currency":"CZK",
                  "creditCost":"1050",
                  "providerEmail":"info@albert.cz",
                  "providerMessage": "Hi PROVIDER. NAME has requested your discount you offered with us: DISCOUNT NAME."
                }' class="discount__btn--claim btn-primary">
              Claim (1050 credits)
            </button>
          </div>
        </div>
      </div>
      <!-- DISCOUNT ROW ENDING -->
    </div>
  </div>

  <!-- MODAL which contains discount information on button click -->
  <div class="modal__wrapper">
    <div class="modal__content modal__closed--content">
      <div class="container-fluid">
        <div class="row">
          <div class="col-md-12">
            <div class="modal__func--close text-right">
              <i class="fas fa-times modal__close"></i>
            </div>

            <h1 class="text-center">Claim discount</h1>
            <p class="text-center">How to claim this discount:</p>
            <div class="discount__instructions">
              <div class="discount__instructions--each">
                <img src="img/discount-instructions-1.png" alt="Confirm" />
                <p>Confirm your contact details in the form below</p>
              </div>
              <div class="discount__instructions--each">
                <img src="img/discount-instructions-2.png" alt="Wait and then pay" />
                <p>Wait for email instructions to pay</p>
              </div>
              <div class="discount__instructions--each">
                <img src="img/discount-instructions-3.png" alt="Enjoy" />
                <p>Enjoy the discount!</p>
              </div>
            </div>
          </div>
          <!-- Form starts. Needs email script -->
          <form action="#" class="detailed-form">
            <div class="col-md-12 search__wrapper--instance">
              <label for="search_city">Jmeno</label>
              <!-- Value should contain users profile name -->
              <input class="form-control" type="text" name="name" value="user-name" required />
            </div>
            <div class="col-md-6 search__wrapper--instance">
              <label for="search_city">Email</label>
              <!-- Value should contain users profile email address -->
              <input class="form-control" type="email" name="email" value="user-email" required />
            </div>
            <div class="col-md-6 search__wrapper--instance">
              <label for="search_city">Telefon</label>
              <!-- Value should contain users phone number -->
              <input class="form-control" type="tel" name="phone" value="user-phone" required />
            </div>
            <div class="clearfix"></div>

            <!-- Information below is filled in automatically from data-discount-info  -->
            <div class="discount__preview">
              <div class="discount__preview--percent"><span class="percent-view"></span>%</div>
              <div class="discount__preview--content">
                <h3 class="name-view"></h3>
                <div class="credits-view">
                  <object class="credits-icon" data="img/credits-icon-green.svg" type="image/svg+xml"></object>
                  <span class="credit-cost"></span> credits
                </div>
                <div class="price-view">
                  <span class="price-now"></span>
                  <span class="new-currency-view"></span>
                </div>
                <div class="before-view">
                  <span class="price-before"></span>
                  <span class="old-currency-view"></span>
                </div>
              </div>
            </div>

            <!-- HIDDEN INPUTS START -->
            <!-- Message for provider. Picked up from data-discount-info -->
            <input class="no-display" type="text" name="provider-message" value="" />
            <!-- Email address for the provider -->
            <input class="no-display" type="text" name="provider-email" value="" />
            <!-- HIDDEN INPUTS END -->

            <div class="col-md-12 search__wrapper--instance">
              <button type="submit" name="submit" class="btn-lime w-100">
                Send discount request <i class="fas fa-angle-right"></i>
              </button>
            </div>
          </form>
          <!-- Form ends -->
        </div>
      </div>
    </div>
    <div class="modal__background modal__closed--behind"></div>
  </div>
  <!-- MODAL ending -->

  <div id="footer">
    <div class="container">
      <div class="row">
        <div class="col-sm-3">
          <ul class="nav flex-column">
            <li class="nav-item">
              <a class="nav-link" href="/o-nas">O nás</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/kontakt">Kontakt</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/nabidnete-slevy">Nabídněte slevy</a>
            </li>
          </ul>
        </div>
        <div class="col-sm-3">
          <ul class="nav flex-column">
            <li class="nav-item">
              <a class="nav-link" href="/spoluprace">Spolupráce</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/podporte-nas">Podpořte nás</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/pravidla">Pravidla použití webu</a>
            </li>
          </ul>
        </div>
        <div class="col-sm-6">
          <ul class="nav justify-content-end">
            <li class="nav-item">
              <a href="#" class="nav-link" target="_blank"><i class="fab fa-facebook fa-2x"></i></a>
            </li>
            <li class="nav-item">
              <a href="#" class="nav-link" target="_blank"><i class="fab fa-twitter-square fa-2x"></i></a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/"><img src="img/ft-logo.png" alt="logo" class="img-fluid" width="120"></a>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
  <!--/#footer-->

  <div id="small-footer">
    <div class="container">
      <div class="row">
        <div class="col-sm-12 text-center">
          <p>
            <a href="#">Copyright &copy; 2019 funtorial.com</a>
          </p>
        </div>
      </div>
    </div>
  </div>
  <!--/#small-footer-->


  <!-- JS -->
  <script>
    // FORMS
    let updateLabelOnActive = function () {
      let inputs = Array.from(document.querySelectorAll('form input')),
        textAreas = Array.from(document.querySelectorAll('form textarea')),
        selects = Array.from(document.querySelectorAll('form select'))

      let allInputs = inputs.concat(textAreas, selects)

      function toggleClass() {
        this.previousElementSibling.classList.toggle('active')
      }
      for (let i = 0; i < allInputs.length; i++) {
        let input = allInputs[i]
        input.addEventListener('focus', toggleClass)
        input.addEventListener('blur', toggleClass)
      }
    }

    updateLabelOnActive()

    // DISCOUNTS PAGE
    const discountFunctions = () => {
      const seeMoreInfo = () => {
        const btnsSeeMore = document.querySelectorAll('.discount__btn--see-more')
        // const btnClaim = document.querySelector('.discount__btn--claim');

        const btnArray = Array.from(btnsSeeMore)
        btnArray.map(btnSeeMore => {
          btnSeeMore.addEventListener('click', e => {
            // Closest content box in relation to the button clicked
            const discountContent = btnSeeMore.parentElement.parentElement.querySelector(
              '.discount__header--content'
            )

            // When closing discount list
            if (discountContent.classList.contains('extended')) {
              discountContent.classList.remove('extended')
              /* html */
              btnSeeMore.innerHTML = `<i class="fas fa-angle-down"></i> See more details`
            }
            // When opening discount list
            else {
              discountContent.classList.add('extended')
              /* html */
              btnSeeMore.innerHTML = `<i class="fas fa-angle-up"></i> See less details`
            }
          })
        })
      }

      const modalFunc = () => {
        const contentModal = document.querySelector('.modal__content'),
          behindModal = document.querySelector('.modal__background'),
          closeBtn = document.querySelector('.modal__close'),
          claimBtns = document.querySelectorAll('.discount__btn--claim')

        const closeModal = () => {
          const close = () => {
            //Adding remove-classes to modal and its background
            contentModal.classList.add('modal__closed--content')
            behindModal.classList.add('modal__closed--behind')
          }
          closeBtn.addEventListener('click', () => close())
          behindModal.addEventListener('click', () => close())
          return true
        }

        const openModal = () => {
          const open = e => {
            contentModal.classList.remove('modal__closed--content')
            behindModal.classList.remove('modal__closed--behind')
            const discountInfo = JSON.parse(e.srcElement.getAttribute('data-discount-info'))

            // Helper function for the preview inside the modal
            const putDiscount = (selector, value) => {
              document.querySelector(selector).innerHTML = discountInfo[value]
            }

            // Helper function to put data to hidden inputs
            const putDiscountInput = (name, value) => {
              document
                .querySelector(`input[name=${name}]`)
                .setAttribute('value', discountInfo[value])
            }

            // Info picked up from discounts-enter
            putDiscount('.old-currency-view', 'currency')
            putDiscount('.new-currency-view', 'currency')
            putDiscount('.name-view', 'name')
            putDiscount('.credit-cost', 'creditCost')
            putDiscount('.price-now', 'priceNew')
            putDiscount('.price-before', 'priceOld')
            putDiscount('.percent-view', 'percent')

            // Adding information to hidden text fields
            putDiscountInput('provider-email', 'providerEmail')
            putDiscountInput('provider-message', 'providerMessage')

            return true
          }

          //Add click event listener to all claim buttons
          claimBtns.forEach(btn => {
            btn.addEventListener('click', e => {
              open(e)
            })
          })
        }
        openModal()
        closeModal()
      }

      //Run functions on page load
      window.addEventListener('DOMContentLoaded', () => {
        seeMoreInfo()
        modalFunc()
      })
    }

    discountFunctions()
  </script>

  <!-- JS -->
  <script src="dist/bundle.js"></script>
</body>

</html>